<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Aurelo Data — Store Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{
    --bg:#070B1A;        /* deep space */
    --bg-2:#0B1328;      /* panels */
    --glass:rgba(255,255,255,.05);
    --card:#0E1733; 
    --text:#E7EEF9; 
    --muted:#9AB0C8;
    --accent:#7C5CFF;    /* Aurelo purple */
    --accent-2:#25D0A6;  /* mint */
    --warn:#FFB454;
    --danger:#FF5D7A;
    --good:#43D17A;
    --border:rgba(255,255,255,.08);
    --shadow:0 10px 30px rgba(0,0,0,.35);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:
    radial-gradient(1200px 800px at 10% -10%, rgba(124,92,255,.15), transparent 60%),
    radial-gradient(800px 600px at 110% 20%, rgba(37,208,166,.12), transparent 50%),
    linear-gradient(180deg,var(--bg),#050912);
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);
  }
  .app{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
  aside{background:linear-gradient(180deg,var(--bg-2),#0a1225);border-right:1px solid var(--border);padding:20px;position:sticky;top:0;height:100vh}
  .brand{display:flex;align-items:center;gap:12px;margin:6px 6px 18px}
  .logo{width:42px;height:42px;border-radius:12px;background:
     conic-gradient(from 120deg, var(--accent), transparent 60%),
     conic-gradient(from -20deg, var(--accent-2), transparent 65%),
     linear-gradient(135deg, #1b2547, #0E1733); box-shadow:0 8px 22px rgba(124,92,255,.25)}
  .brand h1{font-size:18px;letter-spacing:.4px;margin:0}
  .brand small{display:block;color:var(--muted);margin-top:2px}
  nav{margin-top:14px}
  .nav-group{margin:18px 0 6px 10px;color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.12em}
  .nav a{display:flex;align-items:center;gap:10px;padding:10px 12px;margin:6px;border-radius:12px;color:var(--text);text-decoration:none;border:1px solid transparent}
  .nav a:hover{background:var(--glass);border-color:var(--border)}
  .nav a.active{background:linear-gradient(180deg,#121d3f,#0c1430);border-color:#1e2b52}
  .nav .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
  .pro-badge{margin:10px 6px;padding:12px;border-radius:16px;background:linear-gradient(180deg,#101a39,#0b1329);border:1px dashed #243056}
  .pro-badge b{color:var(--accent)}

  header{display:flex;align-items:center;gap:14px;padding:16px 22px;border-bottom:1px solid var(--border);backdrop-filter:saturate(1.2) blur(6px);position:sticky;top:0;z-index:50;background:linear-gradient(180deg,rgba(11,19,40,.75),rgba(11,19,40,.45))}
  .search{flex:1;display:flex;align-items:center;background:var(--glass);border:1px solid var(--border);border-radius:14px;padding:8px 12px}
  .search input{all:unset;flex:1;font-size:14px;color:var(--text)}
  .toolbar{display:flex;gap:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#101a39,#0b1329);color:var(--text);cursor:pointer;box-shadow:var(--shadow)}
  .btn:hover{filter:brightness(1.08)}
  .btn.primary{background:linear-gradient(180deg, #764dff, #5a3fe0);border-color:#6a5bff}
  .btn.ghost{background:var(--glass)}
  .btn.small{padding:6px 10px;border-radius:10px}

  main{padding:22px;display:grid;gap:18px}
  .grid{display:grid;gap:18px}
  .cols-4{grid-template-columns:repeat(4, minmax(0,1fr))}
  .cols-3{grid-template-columns:repeat(3, minmax(0,1fr))}
  .cols-2{grid-template-columns:repeat(2, minmax(0,1fr))}

  .card{background:linear-gradient(180deg,#0f1834,#0b1329);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .card .head{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 0}
  .card .title{font-weight:700;letter-spacing:.3px}
  .card .sub{color:var(--muted);font-size:12px}
  .card .content{padding:14px 16px 18px}
  .kpi{display:flex;align-items:center;justify-content:space-between}
  .kpi .value{font-size:28px;font-weight:800}
  .kpi .trend{font-size:12px;border-radius:999px;padding:6px 10px;border:1px solid var(--border);background:var(--glass)}
  .trend.up{color:var(--good)} .trend.down{color:var(--danger)}

  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{text-align:left;padding:10px 12px;border-bottom:1px solid var(--border)}
  thead th{position:sticky;top:0;background:#0c1430;border-bottom:1px solid #243056;z-index:5}
  tbody tr:hover{background:rgba(124,92,255,.06)}
  .badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:var(--glass);font-size:12px}
  .badge.warn{border-color:#4a3a1f;background:rgba(255,180,84,.08);color:#ffce85}
  .badge.ok{border-color:#1e3b2c;background:rgba(67,209,122,.08);color:#9BE2B9}
  .badge.danger{border-color:#562331;background:rgba(255,93,122,.08);color:#ff9aab}
  .pill{padding:4px 8px;border-radius:8px;background:var(--glass);border:1px solid var(--border);font-size:12px}

  .row{display:flex;gap:14px;align-items:center}
  .row.right{justify-content:flex-end}
  .divider{height:1px;background:var(--border);margin:8px 0}
  .muted{color:var(--muted)}
  .hint{font-size:12px;color:var(--muted)}

  .section{display:none}
  .section.active{display:block}

  /* Modal */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,6,12,.6);backdrop-filter:blur(4px);z-index:100}
  .modal.open{display:flex}
  .modal .panel{width:min(720px,92vw);background:linear-gradient(180deg,#101a39,#0b1329);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow)}
  .modal .panel header{position:static;background:transparent;border:none;padding:16px 18px}
  .modal .panel .body{padding:16px 18px}
  .field{display:grid;gap:8px;margin:10px 0}
  .field label{font-size:12px;color:var(--muted)}
  .field input,.field select,.field textarea{background:var(--glass);border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px 12px;outline:none}

  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--border);background:var(--glass);border-radius:999px;padding:6px 10px;font-size:12px}

  .toast{position:fixed;right:18px;bottom:18px;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#0f1834,#0b1329);box-shadow:var(--shadow);display:none}
  .toast.show{display:block}

  @media (max-width:1200px){
    .cols-4{grid-template-columns:repeat(2, minmax(0,1fr))}
  }
  @media (max-width:900px){
    .app{grid-template-columns:1fr}
    aside{position:static;height:auto}
    header{position:static}
    .cols-3,.cols-4{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Aurelo Data</h1>
          <small>Store Intelligence Console</small>
        </div>
      </div>
      <div class="pro-badge">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
          <div>
            <b>Microknots</b> AI Suite<br>
            <span class="muted" style="font-size:12px">Retail Analytics • Data Packets • Ops</span>
          </div>
          <span class="pill">v1.0</span>
        </div>
      </div>
      <nav class="nav">
        <div class="nav-group">Navigate</div>
        <a href="#" data-section="overview" class="active"><span class="dot"></span> Overview</a>
        <a href="#" data-section="inventory"><span class="dot" style="background:var(--accent-2)"></span> Inventory</a>
        <a href="#" data-section="packets"><span class="dot" style="background:#a16eff"></span> Data Packets</a>
        <a href="#" data-section="logistics"><span class="dot" style="background:#52e3c2"></span> Logistics</a>
        <a href="#" data-section="suppliers"><span class="dot" style="background:#ffd36b"></span> Suppliers</a>
        <a href="#" data-section="finance"><span class="dot" style="background:#7bd77a"></span> Finance</a>
        <a href="#" data-section="marketing"><span class="dot" style="background:#6bd7ff"></span> Marketing</a>
        <a href="#" data-section="alerts"><span class="dot" style="background:#ff6b9a"></span> Alerts & Tasks</a>
        <div class="nav-group">Admin</div>
        <a href="#" data-section="settings"><span class="dot" style="background:#7C5CFF"></span> Settings</a>
      </nav>
      <div style="margin-top:18px" class="hint">Tip: Press <b>/</b> to search, <b>G</b> + <b>O</b> for Overview.</div>
    </aside>

    <!-- MAIN -->
    <div>
      <header>
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#9AB0C8" stroke-width="2" stroke-linecap="round"/><circle cx="10" cy="10" r="6" stroke="#9AB0C8" stroke-width="2" fill="none"/></svg>
          <input id="globalSearch" placeholder="Search products, packets, shipments, suppliers…" />
        </div>
        <div class="toolbar">
          <button class="btn ghost" id="rngBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M7 11h10M7 15h7M7 7h10" stroke="#9AB0C8" stroke-width="2" stroke-linecap="round"/></svg>
            Range: <span id="dateRangeLabel">Last 30 days</span>
          </button>
          <button class="btn" id="exportCSV">Export CSV</button>
          <button class="btn primary" id="addItem">Add Item</button>
        </div>
      </header>

      <main>
        <!-- OVERVIEW -->
        <section id="overview" class="section active">
          <div class="grid cols-4">
            <div class="card">
              <div class="head"><div class="title">Revenue</div><div class="sub">vs last period</div></div>
              <div class="content kpi">
                <div class="value" id="kpiRevenue">$0</div>
                <div class="trend up" id="kpiRevenueTrend">+0%</div>
              </div>
              <div class="content"><canvas id="revChart" height="110"></canvas></div>
            </div>
            <div class="card">
              <div class="head"><div class="title">Gross Margin</div><div class="sub">blended</div></div>
              <div class="content kpi"><div class="value" id="kpiMargin">0%</div><div class="trend" id="kpiMarginTrend">+0.0 pp</div></div>
              <div class="content"><canvas id="marginChart" height="110"></canvas></div>
            </div>
            <div class="card">
              <div class="head"><div class="title">Inventory Health</div><div class="sub">days on hand</div></div>
              <div class="content kpi"><div class="value" id="kpiDOH">0</div><div class="trend down" id="kpiDOHTrend">-0d</div></div>
              <div class="content"><canvas id="dohChart" height="110"></canvas></div>
            </div>
            <div class="card">
              <div class="head"><div class="title">TTM Alerts</div><div class="sub">operational</div></div>
              <div class="content kpi"><div class="value" id="kpiAlerts">0</div><div class="trend" id="kpiAlertsTrend">Open</div></div>
              <div class="content">
                <div class="chips" id="alertChips"></div>
              </div>
            </div>
          </div>

          <div class="grid cols-2">
            <div class="card">
              <div class="head">
                <div>
                  <div class="title">Top 15 SKUs by Contribution</div>
                  <div class="sub">Pareto — 80/20 view</div>
                </div>
                <div class="row">
                  <span class="pill">USD</span>
                  <span class="pill">Last 30 days</span>
                </div>
              </div>
              <div class="content"><canvas id="paretoChart" height="150"></canvas></div>
            </div>

            <div class="card">
              <div class="head">
                <div class="title">Cash Flow (Ops)</div>
                <div class="sub">Inflow vs Outflow</div>
              </div>
              <div class="content"><canvas id="cashChart" height="150"></canvas></div>
            </div>
          </div>
        </section>

        <!-- INVENTORY -->
        <section id="inventory" class="section">
          <div class="card">
            <div class="head">
              <div>
                <div class="title">Inventory</div>
                <div class="sub">Manage stock, reorders, and thresholds</div>
              </div>
              <div class="row">
                <input id="invSearch" placeholder="Filter by SKU or name" style="all:unset;background:var(--glass);border:1px solid var(--border);padding:8px 10px;border-radius:10px"> 
                <select id="invFilter" style="all:unset;background:var(--glass);border:1px solid var(--border);padding:8px 10px;border-radius:10px">
                  <option value="all">All</option>
                  <option value="low">Low stock</option>
                  <option value="oos">Out of stock</option>
                </select>
                <button class="btn small" id="invRecalc">Recompute DOH</button>
              </div>
            </div>
            <div class="content" style="overflow:auto">
              <table id="invTable">
                <thead>
                  <tr>
                    <th>SKU</th><th>Name</th><th>Category</th><th>On Hand</th>
                    <th>Reorder Pt</th><th>Lead (d)</th><th>Unit Cost</th><th>Unit Price</th>
                    <th>DOH</th><th>Status</th><th></th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div class="hint">Inline edit: double‑click cells. Changes persist locally.</div>
            </div>
          </div>
        </section>

        <!-- DATA PACKETS -->
        <section id="packets" class="section">
          <div class="grid cols-2">
            <div class="card">
              <div class="head"><div class="title">Packet Builder</div><div class="sub">Define schema & joins</div></div>
              <div class="content">
                <div class="field">
                  <label>Sources</label>
                  <div class="chips">
                    <span class="chip">POS Sales</span>
                    <span class="chip">Inventory Ledger</span>
                    <span class="chip">Suppliers</span>
                    <span class="chip">Shipments</span>
                    <span class="chip">Marketing Spend</span>
                  </div>
                </div>
                <div class="field">
                  <label>Columns</label>
                  <div class="row" style="gap:10px;flex-wrap:wrap">
                    <label><input type="checkbox" class="pkt-col" value="date" checked> Date</label>
                    <label><input type="checkbox" class="pkt-col" value="sku" checked> SKU</label>
                    <label><input type="checkbox" class="pkt-col" value="name" checked> Name</label>
                    <label><input type="checkbox" class="pkt-col" value="units" checked> Units</label>
                    <label><input type="checkbox" class="pkt-col" value="revenue" checked> Revenue</label>
                    <label><input type="checkbox" class="pkt-col" value="cogs" checked> COGS</label>
                    <label><input type="checkbox" class="pkt-col" value="margin"> Margin%</label>
                    <label><input type="checkbox" class="pkt-col" value="doh"> DOH</label>
                    <label><input type="checkbox" class="pkt-col" value="supplier"> Supplier</label>
                    <label><input type="checkbox" class="pkt-col" value="lead"> LeadDays</label>
                  </div>
                </div>
                <div class="row">
                  <button class="btn" id="pktPreview">Preview (100 rows)</button>
                  <button class="btn primary" id="pktExport">Export JSON</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="head"><div class="title">Preview</div><div class="sub">Synthetic sample</div></div>
              <div class="content" style="max-height:360px;overflow:auto">
                <table id="pktTable"><thead></thead><tbody></tbody></table>
              </div>
            </div>
          </div>
        </section>

        <!-- LOGISTICS -->
        <section id="logistics" class="section">
          <div class="card">
            <div class="head"><div class="title">Shipments Tracker</div><div class="sub">Inbound & Outbound</div></div>
            <div class="content" style="overflow:auto">
              <table id="shipTable">
                <thead>
                  <tr>
                    <th>#</th><th>Type</th><th>Carrier</th><th>ETA</th><th>From → To</th><th>Items</th><th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- SUPPLIERS -->
        <section id="suppliers" class="section">
          <div class="grid cols-3" id="supGrid"></div>
        </section>

        <!-- FINANCE -->
        <section id="finance" class="section">
          <div class="grid cols-3">
            <div class="card"><div class="head"><div class="title">Revenue vs COGS</div></div><div class="content"><canvas id="finRev" height="140"></canvas></div></div>
            <div class="card"><div class="head"><div class="title">Category Mix</div></div><div class="content"><canvas id="finMix" height="140"></canvas></div></div>
            <div class="card"><div class="head"><div class="title">Monthly Profit</div></div><div class="content"><canvas id="finProfit" height="140"></canvas></div></div>
          </div>
          <div class="card">
            <div class="head"><div class="title">AP/AR Aging</div><div class="sub">Outstanding balances</div></div>
            <div class="content" style="overflow:auto">
              <table id="agingTable"><thead><tr><th>Partner</th><th>Type</th><th>0–30</th><th>31–60</th><th>61–90</th><th>90+</th><th>Total</th></tr></thead><tbody></tbody></table>
            </div>
          </div>
        </section>

        <!-- MARKETING -->
        <section id="marketing" class="section">
          <div class="grid cols-2">
            <div class="card"><div class="head"><div class="title">Campaign ROAS</div><div class="sub">by channel</div></div><div class="content"><canvas id="mkRoas" height="160"></canvas></div></div>
            <div class="card"><div class="head"><div class="title">Funnel</div><div class="sub">session → purchase</div></div><div class="content"><canvas id="mkFunnel" height="160"></canvas></div></div>
          </div>
        </section>

        <!-- ALERTS & TASKS -->
        <section id="alerts" class="section">
          <div class="grid cols-2">
            <div class="card">
              <div class="head"><div class="title">Operational Alerts</div><div class="sub">Auto-generated</div></div>
              <div class="content" id="alertList"></div>
            </div>
            <div class="card">
              <div class="head"><div class="title">Task Board</div><div class="sub">Today & Upcoming</div></div>
              <div class="content" id="taskList"></div>
            </div>
          </div>
        </section>

        <!-- SETTINGS -->
        <section id="settings" class="section">
          <div class="grid cols-2">
            <div class="card">
              <div class="head"><div class="title">Preferences</div><div class="sub">Persisted locally</div></div>
              <div class="content">
                <div class="field"><label>Currency</label>
                  <select id="prefCurrency">
                    <option value="USD">USD</option>
                    <option value="EUR">EUR</option>
                    <option value="CNY">CNY</option>
                  </select>
                </div>
                <div class="field"><label>Theme Accents</label>
                  <div class="row"><input id="accentPicker" type="color" value="#7C5CFF"><span class="hint">Affects charts & highlights</span></div>
                </div>
                <div class="row">
                  <button class="btn" id="savePrefs">Save</button>
                  <button class="btn ghost" id="resetPrefs">Reset</button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="head"><div class="title">Data</div><div class="sub">Import / Export</div></div>
              <div class="content">
                <div class="field"><label>Import Inventory CSV</label>
                  <input type="file" id="csvFile" accept=".csv" />
                </div>
                <button class="btn" id="importCsvBtn">Import</button>
                <div class="divider"></div>
                <button class="btn primary" id="downloadState">Download State JSON</button>
                <span class="hint">For backup or transfer</span>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- MODAL: ADD ITEM -->
  <div class="modal" id="modal">
    <div class="panel">
      <header>
        <div class="title">Add Inventory Item</div>
        <button class="btn small ghost" id="closeModal">Close</button>
      </header>
      <div class="body">
        <div class="grid cols-2">
          <div class="field"><label>SKU</label><input id="mSku" placeholder="SKU-001"></div>
          <div class="field"><label>Name</label><input id="mName" placeholder="Blueberry Muffin"></div>
          <div class="field"><label>Category</label><input id="mCat" placeholder="Bakery"></div>
          <div class="field"><label>On Hand</label><input id="mQty" type="number" value="20"></div>
          <div class="field"><label>Reorder Pt</label><input id="mROP" type="number" value="10"></div>
          <div class="field"><label>Lead Days</label><input id="mLead" type="number" value="7"></div>
          <div class="field"><label>Unit Cost</label><input id="mCost" type="number" step="0.01" value="2.25"></div>
          <div class="field"><label>Unit Price</label><input id="mPrice" type="number" step="0.01" value="3.99"></div>
        </div>
        <div class="row right"><button class="btn primary" id="mSave">Save Item</button></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(function(){
  // ---- Utilities ----
  const $ = sel => document.querySelector(sel);
  const $$ = sel => [...document.querySelectorAll(sel)];
  const fmt = (v,curr='USD') => new Intl.NumberFormat('en-US',{style:'currency',currency:curr,maximumFractionDigits:0}).format(v);
  const rand = (a,b) => Math.round(a + Math.random()*(b-a));
  const sample = arr => arr[Math.floor(Math.random()*arr.length)];
  const toast = (msg) => { const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2200) };
  const saveLS = (k,v)=>localStorage.setItem(k,JSON.stringify(v));
  const getLS = (k,d)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? d}catch(e){return d}};

  // ---- State (synthetic demo) ----
  const state = getLS('aurelo_state', {
    prefs:{currency:'USD',accent:'#7C5CFF'},
    inventory:[], shipments:[], suppliers:[], alerts:[], tasks:[], sales:[]
  });

  // Seed data if empty
  if(state.inventory.length===0){
    const cats=['Bakery','Beverages','Snacks','Produce','Dairy','Household'];
    for(let i=1;i<=80;i++){
      const cat = sample(cats);
      const price = rand(2,80)+0.99; const cost = +(price*(0.5+Math.random()*0.2)).toFixed(2);
      const onhand = rand(0,260); const rop = rand(8,40); const lead = rand(3,14);
      state.inventory.push({sku:`SKU-${String(i).padStart(3,'0')}`, name:`Product ${i}`, cat, qty:onhand, rop, lead, cost, price, doh: rand(5,40)});
    }
  }
  if(state.sales.length===0){
    for(let d=29; d>=0; d--){
      state.sales.push({date: new Date(Date.now()-d*86400000), revenue: rand(2400,8800), cogs: rand(1200,5200)});
    }
  }
  if(state.shipments.length===0){
    const carriers=['UPS','FedEx','USPS','DHL'];
    for(let i=1;i<=16;i++){
      const inbound = Math.random()>.5;
      state.shipments.push({id:1000+i, type: inbound?'Inbound':'Outbound', carrier: sample(carriers), etaDays: rand(1,14), from: inbound?'Supplier Hub':'Main Store', to: inbound?'Main Store':'Customer', items: rand(5,120), status: sample(['Created','In Transit','Delayed','Delivered'])});
    }
  }
  if(state.suppliers.length===0){
    for(let i=1;i<=9;i++){
      state.suppliers.push({name:`Supplier ${i}`, rating: (3+Math.random()*2).toFixed(1), lead: rand(3,18), moq: rand(20,120), contact:`contact${i}@vendor.com`});
    }
  }
  if(state.alerts.length===0){
    const lowSkus = state.inventory.filter(x=>x.qty<x.rop).slice(0,6);
    state.alerts = [
      ...lowSkus.map(x=>({type:'Inventory', severity:'High', text:`Low stock for ${x.sku} (${x.name})`, tag:'Reorder'})),
      {type:'Ops', severity:'Medium', text:'Shipment #1011 delayed 2 days', tag:'Logistics'},
      {type:'Finance', severity:'Low', text:'AP aging 61–90 bucket above threshold', tag:'AP'},
    ];
  }
  if(state.tasks.length===0){
    state.tasks = [
      {text:'Place PO for Bakery staples', done:false},
      {text:'Export September Data Packet', done:true},
      {text:'Review Supplier 4 SLA', done:false},
    ];
  }

  // Persist initial seed if new
  saveLS('aurelo_state', state);

  // ---- Navigation ----
  const setSection = id => {
    $$('.section').forEach(s=>s.classList.remove('active'));
    $('#'+id).classList.add('active');
    $$('.nav a').forEach(a=>a.classList.toggle('active', a.dataset.section===id));
  };
  $$('.nav a').forEach(a=> a.addEventListener('click', e=>{ e.preventDefault(); setSection(a.dataset.section) }));

  // Hotkeys
  document.addEventListener('keydown', e=>{
    if(e.key==='/'){ e.preventDefault(); $('#globalSearch').focus(); }
    if(e.key.toLowerCase()==='g' && e.metaKey===false && e.ctrlKey===false){
      // simple chord G+O for overview
      document.addEventListener('keydown', function go(ev){ if(ev.key.toLowerCase()==='o'){ setSection('overview'); document.removeEventListener('keydown', go) }}, {once:true});
    }
  })

  // ---- Overview KPIs & Charts ----
  const currency = ()=> getLS('aurelo_state', state).prefs.currency;
  const accent = ()=> getLS('aurelo_state', state).prefs.accent;
  function computeKPIs(){
    const s = getLS('aurelo_state', state).sales;
    const last = s.slice(-7); const prev = s.slice(-14,-7);
    const sum = arr => arr.reduce((t,x)=>t+x,0);
    const revNow = sum(last.map(x=>x.revenue));
    const revPrev = sum(prev.map(x=>x.revenue))||1;
    const trend = ((revNow-revPrev)/revPrev*100).toFixed(1);
    $('#kpiRevenue').textContent = fmt(revNow, currency());
    $('#kpiRevenueTrend').textContent = (trend>=0?'+':'')+trend+'%';
    $('#kpiRevenueTrend').classList.toggle('up', trend>=0);
    $('#kpiRevenueTrend').classList.toggle('down', trend<0);

    const cogsNow = sum(last.map(x=>x.cogs));
    const margin = (1 - cogsNow/revNow)*100; const marginPrev = (1 - (sum(prev.map(x=>x.cogs))/revPrev))*100;
    $('#kpiMargin').textContent = margin.toFixed(1)+'%';
    $('#kpiMarginTrend').textContent = ((margin-marginPrev)>=0?'+':'')+ (margin-marginPrev).toFixed(1) + ' pp';

    const doh = Math.round(getLS('aurelo_state', state).inventory.reduce((t,x)=>t+x.doh,0)/state.inventory.length);
    $('#kpiDOH').textContent = doh; $('#kpiDOHTrend').textContent = (doh-22>=0?'+':'')+(doh-22)+'d';

    $('#kpiAlerts').textContent = getLS('aurelo_state', state).alerts.length;
    const chips = $('#alertChips'); chips.innerHTML='';
    getLS('aurelo_state', state).alerts.slice(0,8).forEach(a=>{
      const el = document.createElement('span'); el.className='chip'; el.textContent = a.tag; chips.appendChild(el)
    })
  }

  function makeLine(id, labels, datasets){
    return new Chart(document.getElementById(id), {
      type:'line', data:{ labels, datasets }, options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{labels:{color:'#cfe0ff'} }},
        scales:{ x:{ticks:{color:'#9AB0C8'}}, y:{ticks:{color:'#9AB0C8'}, grid:{color:'rgba(255,255,255,.08)'}} }
      }});
  }
  function makeBar(id, labels, datasets){
    return new Chart(document.getElementById(id), {
      type:'bar', data:{ labels, datasets }, options:{
        responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{labels:{color:'#cfe0ff'} }},
        scales:{ x:{ticks:{color:'#9AB0C8'}}, y:{ticks:{color:'#9AB0C8'}, grid:{color:'rgba(255,255,255,.08)'}} }
      }});
  }

  const sLabels = state.sales.map(x=> new Date(x.date).toLocaleDateString());
  const revChart = makeLine('revChart', sLabels, [
    { label:'Revenue', data: state.sales.map(x=>x.revenue), borderColor: accent(), fill:false },
    { label:'COGS', data: state.sales.map(x=>x.cogs), borderColor: '#25D0A6', fill:false }
  ]);
  const marginChart = makeBar('marginChart', sLabels, [
    { label:'Margin %', data: state.sales.map(x=>Math.round((1-x.cogs/x.revenue)*100)), backgroundColor: accent() }
  ]);
  const dohChart = makeLine('dohChart', state.inventory.slice(0,30).map(x=>x.sku), [
    { label:'DOH', data: state.inventory.slice(0,30).map(x=>x.doh), borderColor:'#52e3c2', fill:false }
  ]);

  // Pareto (Top SKUs)
  const top = [...state.inventory].sort((a,b)=> (b.price-b.cost)*b.qty - (a.price-a.cost)*a.qty).slice(0,15);
  makeBar('paretoChart', top.map(x=>x.sku), [{label:'Contribution', data: top.map(x=>Math.round((x.price-x.cost)*x.qty)), backgroundColor: accent()}]);

  // Cash Flow
  const inflow = state.sales.map(x=> x.revenue * (0.92 + Math.random()*0.08));
  const outflow = state.sales.map(x=> x.cogs * (0.95 + Math.random()*0.10));
  makeLine('cashChart', sLabels, [
    {label:'Inflow', data: inflow, borderColor: '#7bd77a', fill:false},
    {label:'Outflow', data: outflow, borderColor: '#ff9aab', fill:false}
  ]);

  computeKPIs();

  // ---- Inventory Table ----
  function renderInventory(){
    const body = $('#invTable tbody'); body.innerHTML='';
    const q = $('#invSearch').value.toLowerCase();
    const filter = $('#invFilter').value;
    const rows = getLS('aurelo_state', state).inventory.filter(r=>{
      const match = (r.sku.toLowerCase().includes(q) || r.name.toLowerCase().includes(q));
      const tag = r.qty===0? 'oos' : (r.qty<r.rop? 'low':'ok');
      return match && (filter==='all' || filter===tag);
    });
    rows.forEach(r=>{
      const tr=document.createElement('tr');
      const status = r.qty===0? '<span class="badge danger">OOS</span>' : (r.qty<r.rop? '<span class="badge warn">Low</span>' : '<span class="badge ok">OK</span>');
      tr.innerHTML = `
        <td>${r.sku}</td>
        <td class="editable" data-k="name">${r.name}</td>
        <td class="editable" data-k="cat">${r.cat}</td>
        <td class="editable" data-k="qty">${r.qty}</td>
        <td class="editable" data-k="rop">${r.rop}</td>
        <td class="editable" data-k="lead">${r.lead}</td>
        <td class="editable" data-k="cost">${r.cost}</td>
        <td class="editable" data-k="price">${r.price}</td>
        <td>${r.doh}</td>
        <td>${status}</td>
        <td><button class="btn small ghost del" data-sku="${r.sku}">Delete</button></td>`;
      body.appendChild(tr);
    });
  }
  renderInventory();

  // Inline edit
  $('#invTable').addEventListener('dblclick', e=>{
    const cell = e.target.closest('.editable'); if(!cell) return; const k = cell.dataset.k; const old = cell.textContent.trim();
    const inp = document.createElement('input'); inp.value=old; inp.style.width='100%'; inp.style.all='unset'; inp.style.padding='6px 8px'; inp.style.border='1px solid var(--border)'; inp.style.borderRadius='8px'; inp.style.background='var(--glass)';
    cell.textContent=''; cell.appendChild(inp); inp.focus();
    inp.addEventListener('keydown', ev=>{ if(ev.key==='Enter') inp.blur(); });
    inp.addEventListener('blur', ()=>{
      const sku = cell.parentElement.firstElementChild.textContent; const inv = getLS('aurelo_state', state).inventory;
      const row = inv.find(x=>x.sku===sku); const v = (k==='name'||k==='cat')? inp.value : Number(inp.value);
      row[k] = v; saveLS('aurelo_state', {...getLS('aurelo_state', state), inventory:inv});
      cell.textContent = inp.value; computeKPIs();
    })
  })
  // Delete
  $('#invTable').addEventListener('click', e=>{ const btn=e.target.closest('.del'); if(!btn) return; const sku=btn.dataset.sku; const S=getLS('aurelo_state', state); S.inventory=S.inventory.filter(x=>x.sku!==sku); saveLS('aurelo_state', S); renderInventory(); computeKPIs(); toast('Deleted '+sku) })

  $('#invSearch').addEventListener('input', renderInventory);
  $('#invFilter').addEventListener('change', renderInventory);
  $('#invRecalc').addEventListener('click', ()=>{ const S=getLS('aurelo_state', state); S.inventory.forEach(x=> x.doh = Math.max(1, Math.round(x.qty/Math.max(1, rand(2,8)))) ); saveLS('aurelo_state', S); renderInventory(); computeKPIs(); toast('Recomputed DOH') });

  // Export CSV of inventory
  $('#exportCSV').addEventListener('click', ()=>{
    const rows = [['SKU','Name','Category','OnHand','ReorderPt','Lead','UnitCost','UnitPrice','DOH']].concat(getLS('aurelo_state', state).inventory.map(r=>[r.sku,r.name,r.cat,r.qty,r.rop,r.lead,r.cost,r.price,r.doh]));
    const blob = new Blob([rows.map(r=>r.join(',')).join('\n')],{type:'text/csv'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='aurelo_inventory.csv'; a.click();
  });

  // Modal Add Item
  $('#addItem').addEventListener('click', ()=> $('#modal').classList.add('open'));
  $('#closeModal').addEventListener('click', ()=> $('#modal').classList.remove('open'));
  $('#mSave').addEventListener('click', ()=>{
    const item={ sku:$('#mSku').value||`SKU-${Date.now()}`, name:$('#mName').value||'New Item', cat:$('#mCat').value||'General', qty:+$('#mQty').value||0, rop:+$('#mROP').value||10, lead:+$('#mLead').value||7, cost:+$('#mCost').value||1, price:+$('#mPrice').value||2, doh:rand(5,30)};
    const S=getLS('aurelo_state', state); S.inventory.unshift(item); saveLS('aurelo_state', S); renderInventory(); computeKPIs(); $('#modal').classList.remove('open'); toast('Item added')
  })

  // ---- Packet Builder ----
  function renderPacket(cols, n=100){
    const thead=$('#pktTable thead'), tbody=$('#pktTable tbody'); thead.innerHTML=''; tbody.innerHTML='';
    const th = document.createElement('tr'); cols.forEach(c=>{ const h=document.createElement('th'); h.textContent=c; th.appendChild(h) }); thead.appendChild(th);
    for(let i=0;i<n;i++){
      const row={ date:new Date(Date.now()-rand(0,30)*864e5).toISOString().slice(0,10), sku: sample(state.inventory).sku, name: sample(state.inventory).name, units: rand(1,40), revenue: rand(20,600), cogs: rand(10,400), margin: rand(20,60), doh: rand(5,40), supplier: sample(state.suppliers).name, lead: rand(3,15) };
      const tr=document.createElement('tr'); cols.forEach(c=>{ const td=document.createElement('td'); td.textContent=row[c]??''; tr.appendChild(td) }); tbody.appendChild(tr);
    }
  }
  $('#pktPreview').addEventListener('click', ()=>{ const cols = $$('.pkt-col:checked').map(x=>x.value); renderPacket(cols, 100); toast('Preview generated') })
  $('#pktExport').addEventListener('click', ()=>{
    const cols = $$('.pkt-col:checked').map(x=>x.value); const out=[]; for(let i=0;i<200;i++){ const r={ date:new Date(Date.now()-rand(0,30)*864e5).toISOString().slice(0,10), sku: sample(state.inventory).sku, name: sample(state.inventory).name, units: rand(1,40), revenue: rand(20,600), cogs: rand(10,400), margin: rand(20,60), doh: rand(5,40), supplier: sample(state.suppliers).name, lead: rand(3,15) }; out.push(Object.fromEntries(cols.map(c=>[c, r[c]]))) }
    const blob=new Blob([JSON.stringify(out,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='aurelo_packet.json'; a.click();
  })

  // ---- Logistics ----
  function renderShipments(){
    const body=$('#shipTable tbody'); body.innerHTML='';
    getLS('aurelo_state', state).shipments.forEach(s=>{
      const badge = s.status==='Delivered'? 'ok' : s.status==='Delayed'? 'warn' : 'info';
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${s.id}</td><td>${s.type}</td><td>${s.carrier}</td><td>${new Date(Date.now()+s.etaDays*864e5).toISOString().slice(0,10)}</td><td>${s.from} → ${s.to}</td><td>${s.items}</td><td><span class="badge ${badge}">${s.status}</span></td>`;
      body.appendChild(tr);
    })
  }
  renderShipments();

  // ---- Suppliers ----
  function renderSuppliers(){
    const grid=$('#supGrid'); grid.innerHTML='';
    getLS('aurelo_state', state).suppliers.forEach(s=>{
      const card=document.createElement('div'); card.className='card';
      card.innerHTML=`<div class="content">
          <div class="row" style="justify-content:space-between"><div>
            <div class="title">${s.name}</div>
            <div class="muted">Lead: ${s.lead} days • MOQ: ${s.moq}</div>
          </div>
          <span class="badge ok">Rating ${s.rating}</span></div>
          <div class="divider"></div>
          <div class="row" style="justify-content:space-between">
            <span class="muted">Contact</span>
            <a class="pill" href="mailto:${s.contact}">${s.contact}</a>
          </div>
        </div>`;
      grid.appendChild(card);
    })
  }
  renderSuppliers();

  // ---- Finance ----
  makeLine('finRev', sLabels, [ {label:'Revenue', data: state.sales.map(x=>x.revenue), borderColor: accent(), fill:false}, {label:'COGS', data: state.sales.map(x=>x.cogs), borderColor:'#ff9aab', fill:false} ]);
  makeBar('finMix', ['Bakery','Beverages','Snacks','Produce','Dairy','Household'], [ {label:'Mix %', data: [18,22,16,14,12,18], backgroundColor: accent()} ]);
  makeBar('finProfit', sLabels, [ {label:'Profit', data: state.sales.map(x=> Math.max(0, x.revenue-x.cogs)), backgroundColor:'#25D0A6'} ]);

  // Aging table
  (function(){
    const partners=['Supplier 1','Supplier 2','Supplier 3','Wholesale X','Account A','Account B'];
    const body=$('#agingTable tbody'); body.innerHTML='';
    partners.forEach(p=>{
      const type = p.startsWith('Supplier')||p.startsWith('Wholesale')? 'AP' : 'AR';
      const b=[rand(400,1800),rand(300,1300),rand(0,900),rand(0,700)]; const total=b.reduce((a,c)=>a+c,0);
      const tr=document.createElement('tr'); tr.innerHTML=`<td>${p}</td><td>${type}</td><td>${fmt(b[0],currency())}</td><td>${fmt(b[1],currency())}</td><td>${fmt(b[2],currency())}</td><td>${fmt(b[3],currency())}</td><td>${fmt(total,currency())}</td>`; body.appendChild(tr);
    })
  })();

  // ---- Marketing ----
  makeBar('mkRoas', ['Search','Social','Email','Affiliates','In‑store'], [ {label:'ROAS', data:[3.2,2.4,5.1,2.1,6.0], backgroundColor: accent()} ]);
  // Simple funnel as bar (sessions→purchase)
  makeBar('mkFunnel', ['Sessions','Views','Adds','Checkouts','Purchases'], [ {label:'Count', data:[12000,7200,1800,900,520], backgroundColor:'#6bd7ff'} ]);

  // ---- Alerts & Tasks ----
  function renderAlerts(){
    const box=$('#alertList'); box.innerHTML='';
    getLS('aurelo_state', state).alerts.forEach(a=>{
      const wrap=document.createElement('div'); wrap.style.margin='8px 0';
      const cls = a.severity==='High'?'danger': a.severity==='Medium'?'warn':'ok';
      wrap.innerHTML=`<div class="row" style="justify-content:space-between"><div>
        <span class="badge ${cls}">${a.severity}</span>
        <b style="margin-left:8px">${a.type}</b> — <span class="muted">${a.text}</span>
      </div>
      <button class="btn small ghost ack">Acknowledge</button></div>`;
      wrap.querySelector('.ack').addEventListener('click', ()=>{ wrap.remove(); toast('Alert acknowledged') });
      box.appendChild(wrap);
    })
  }
  function renderTasks(){
    const box=$('#taskList'); box.innerHTML='';
    const S=getLS('aurelo_state', state);
    S.tasks.forEach((t,i)=>{
      const row=document.createElement('div'); row.className='row'; row.style.justifyContent='space-between'; row.style.margin='6px 0';
      row.innerHTML=`<label style="display:flex;align-items:center;gap:8px"><input type="checkbox" ${t.done?'checked':''}/> ${t.text}</label>
      <button class="btn small ghost rm">Remove</button>`;
      row.querySelector('input').addEventListener('change', ev=>{ S.tasks[i].done=ev.target.checked; saveLS('aurelo_state', S) });
      row.querySelector('.rm').addEventListener('click', ()=>{ S.tasks.splice(i,1); saveLS('aurelo_state', S); renderTasks(); });
      box.appendChild(row);
    });
    const add=document.createElement('div'); add.className='row'; add.style.marginTop='10px'; add.innerHTML=`<input id="taskNew" placeholder="New task" style="all:unset;background:var(--glass);border:1px solid var(--border);padding:8px 10px;border-radius:10px;flex:1"><button class="btn small">Add</button>`;
    add.querySelector('button').addEventListener('click', ()=>{ const txt=$('#taskNew').value.trim(); if(!txt) return; S.tasks.push({text:txt,done:false}); saveLS('aurelo_state', S); renderTasks(); })
    box.appendChild(add);
  }
  renderAlerts(); renderTasks();

  // ---- Preferences / Data ----
  function loadPrefs(){ const p=getLS('aurelo_state', state).prefs; $('#prefCurrency').value=p.currency; $('#accentPicker').value=p.accent }
  loadPrefs();
  $('#savePrefs').addEventListener('click', ()=>{ const S=getLS('aurelo_state', state); S.prefs.currency=$('#prefCurrency').value; S.prefs.accent=$('#accentPicker').value; saveLS('aurelo_state', S); toast('Preferences saved. Reloading charts…'); setTimeout(()=>location.reload(), 600) })
  $('#resetPrefs').addEventListener('click', ()=>{ localStorage.removeItem('aurelo_state'); toast('Reset complete'); setTimeout(()=>location.reload(), 500) })

  // Download JSON state
  $('#downloadState').addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(getLS('aurelo_state', state),null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='aurelo_state.json'; a.click(); })

  // Import CSV (very light parser)
  $('#importCsvBtn').addEventListener('click', ()=>{
    const f=$('#csvFile').files[0]; if(!f) return toast('Choose a CSV first');
    const reader=new FileReader(); reader.onload=e=>{
      const lines=e.target.result.split(/\r?\n/).filter(Boolean); const head=lines.shift().split(',').map(x=>x.trim());
      const required=['SKU','Name','Category','OnHand','ReorderPt','Lead','UnitCost','UnitPrice','DOH'];
      if(required.some((h,i)=> (head[i]||'').trim()!==h)) { toast('CSV headers mismatch'); return }
      const inv = lines.map(line=>{ const v=line.split(','); return { sku:v[0], name:v[1], cat:v[2], qty:+v[3], rop:+v[4], lead:+v[5], cost:+v[6], price:+v[7], doh:+v[8] } });
      const S=getLS('aurelo_state', state); S.inventory = inv; saveLS('aurelo_state', S); renderInventory(); computeKPIs(); toast('Imported '+inv.length+' rows')
    }; reader.readAsText(f);
  })

  // Global search
  $('#globalSearch').addEventListener('keydown', e=>{ if(e.key==='Enter'){ const q=e.target.value.toLowerCase(); if(!q) return; const hit = state.inventory.find(x=> x.sku.toLowerCase()===q || x.name.toLowerCase().includes(q) ); if(hit){ setSection('inventory'); $('#invSearch').value = hit.sku; renderInventory(); toast('Found '+hit.sku) } else { toast('No direct hit — try broader terms') } } })

  // Date Range (mock)
  $('#rngBtn').addEventListener('click', ()=>{ const lab=$('#dateRangeLabel'); lab.textContent = lab.textContent==='Last 30 days'? 'Last 90 days':'Last 30 days'; toast('Range changed (demo)') })

})();
</script>
</body>
</html>
